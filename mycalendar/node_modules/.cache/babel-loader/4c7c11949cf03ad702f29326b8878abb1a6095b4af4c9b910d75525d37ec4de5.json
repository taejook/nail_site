{"ast":null,"code":"import{createContext,useContext,useEffect,useMemo,useState}from\"react\";import{setToken as setApiToken,loginUser,registerUser}from\"../utils/api\";import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(null);export function AuthProvider(_ref){let{children}=_ref;const[user,setUser]=useState(null);// { id, email, fullName }\nconst[token,setToken]=useState(null);// jwt\nconst[loading,setLoading]=useState(true);useEffect(()=>{const savedToken=localStorage.getItem(\"token\");const savedUser=localStorage.getItem(\"user\");if(savedToken){setToken(savedToken);setApiToken(savedToken);}if(savedUser){try{setUser(JSON.parse(savedUser));}catch(_unused){}}setLoading(false);},[]);const login=async _ref2=>{let{email,password}=_ref2;const data=await loginUser({email,password});if(!data||data.error)return{error:(data===null||data===void 0?void 0:data.error)||\"Login failed\"};if(!data.token||!data.user)return{error:\"Invalid response\"};setToken(data.token);setUser(data.user);setApiToken(data.token);localStorage.setItem(\"token\",data.token);localStorage.setItem(\"user\",JSON.stringify(data.user));return{ok:true};};const register=async _ref3=>{let{fullName,email,password}=_ref3;const data=await registerUser({fullName,email,password});if(data!==null&&data!==void 0&&data.error)return{error:data.error};if(data!==null&&data!==void 0&&data.token&&data!==null&&data!==void 0&&data.user){setToken(data.token);setUser(data.user);setApiToken(data.token);localStorage.setItem(\"token\",data.token);localStorage.setItem(\"user\",JSON.stringify(data.user));}return{ok:true};};const logout=()=>{setToken(null);setUser(null);setApiToken(null);localStorage.removeItem(\"token\");localStorage.removeItem(\"user\");};const value=useMemo(()=>({user,token,loading,login,register,logout}),[user,token,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});}export function useAuth(){const ctx=useContext(AuthContext);if(!ctx)throw new Error(\"useAuth must be used within AuthProvider\");return ctx;}","map":{"version":3,"names":["createContext","useContext","useEffect","useMemo","useState","setToken","setApiToken","loginUser","registerUser","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","token","loading","setLoading","savedToken","localStorage","getItem","savedUser","JSON","parse","_unused","login","_ref2","email","password","data","error","setItem","stringify","ok","register","_ref3","fullName","logout","removeItem","value","Provider","useAuth","ctx","Error"],"sources":["C:/Users/dah03/nail-site/mycalendar/src/context/AuthContext.jsx"],"sourcesContent":["import { createContext, useContext, useEffect, useMemo, useState } from \"react\";\r\nimport { setToken as setApiToken, loginUser, registerUser } from \"../utils/api\";\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null);   // { id, email, fullName }\r\n  const [token, setToken] = useState(null); // jwt\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const savedToken = localStorage.getItem(\"token\");\r\n    const savedUser = localStorage.getItem(\"user\");\r\n    if (savedToken) {\r\n      setToken(savedToken);\r\n      setApiToken(savedToken);\r\n    }\r\n    if (savedUser) {\r\n      try { setUser(JSON.parse(savedUser)); } catch {}\r\n    }\r\n    setLoading(false);\r\n  }, []);\r\n\r\n  const login = async ({ email, password }) => {\r\n    const data = await loginUser({ email, password });\r\n    if (!data || data.error) return { error: data?.error || \"Login failed\" };\r\n    if (!data.token || !data.user) return { error: \"Invalid response\" };\r\n\r\n    setToken(data.token);\r\n    setUser(data.user);\r\n    setApiToken(data.token);\r\n    localStorage.setItem(\"token\", data.token);\r\n    localStorage.setItem(\"user\", JSON.stringify(data.user));\r\n    return { ok: true };\r\n  };\r\n\r\n  const register = async ({ fullName, email, password }) => {\r\n    const data = await registerUser({ fullName, email, password });\r\n    if (data?.error) return { error: data.error };\r\n\r\n    if (data?.token && data?.user) {\r\n      setToken(data.token);\r\n      setUser(data.user);\r\n      setApiToken(data.token);\r\n      localStorage.setItem(\"token\", data.token);\r\n      localStorage.setItem(\"user\", JSON.stringify(data.user));\r\n    }\r\n    return { ok: true };\r\n  };\r\n\r\n  const logout = () => {\r\n    setToken(null);\r\n    setUser(null);\r\n    setApiToken(null);\r\n    localStorage.removeItem(\"token\");\r\n    localStorage.removeItem(\"user\");\r\n  };\r\n\r\n  const value = useMemo(() => ({ user, token, loading, login, register, logout }), [user, token, loading]);\r\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n}\r\n\r\nexport function useAuth() {\r\n  const ctx = useContext(AuthContext);\r\n  if (!ctx) throw new Error(\"useAuth must be used within AuthProvider\");\r\n  return ctx;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}